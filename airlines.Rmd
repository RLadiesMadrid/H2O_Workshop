---
title: "H2O Workshop"
subtitle: Airlines Dataframe
output:
  html_document:
    df_print: paged
---

## Requirements

For compatibility with H2O:

1. Operating Systems:

  - Windows 7 or later
  - OS X 10.9 or later
  - Ubuntu 12.04
  - RHEL/CentOS 6 or later

2. Languages: 
  - Scala (2.10 or later), R (3 or later), and Python (2.7.x, 3.5.x, 3.6.x) are not required to use H2O unless you want to use H2O in those environments.
  - Java is always required. Supported versions include:
    - Java 7 or later. Note: Java 9 is released, but is not currently supported. 
  - To build H2O or run H2O tests, the 64-bit JDK is required.
  - To run the H2O binary using either the command line, R, or Python packages, only 64-bit JRE is required.

3. Browser: An internet browser is required to use H2Oâ€™s web UI, Flow. 
  - Latest version of Chrome, Firefox, Safari, or Internet Explorer.

### About H2O

H2O is fast, scalable, open-source machine learning and deep learning. Advanced algorithms such as deep learning, boosting, and bagging ensembles are built-in.

[Download H2O](https://www.h2o.ai/h2o/) to do some machine learning.

[Documentation](http://docs.h2o.ai/h2o/latest-stable/h2o-docs/index.html).

## Set your environment

```{r environment}
# Install snippet
# source('install.R')

library(h2o)
h2o.init()
# h2o.clusterInfo()
```

## Data wrangling

[Data information](http://stat-computing.org/dataexpo/2009/the-data.html)

Prepare your data for modelling.

```{r data}
flights.hex <- h2o.importFile(path = 'flight_data/2008.csv', 
                     destination_frame = 'flights.hex')
flights.hex[1:5, ]
summary(flights.hex, exact_quantiles=TRUE)
```

Quantiles and histograms

- Quantile: A sorted sample is divided into equal-sized, adjacent, subgroups. The quartiles are the 25, 50, and 75 quantiles. The percentiles are quantiles that divide a distribution into 100 equal parts. The median is the 50 quantile.

- Histogram: A function that counts the number of observations that fall into each of the disjoint categories (bins).

```{r quantiles}
quantile(x =  flights.hex$ArrDelay, na.rm = TRUE)
h2o.hist(flights.hex$ArrDelay)
```

Exploration of the dataset

```{r by_month}
by_month <- h2o.group_by(flights.hex, by = "Month", nrow("Month"), 
                         gb.control=list(na.methods="rm"))
by_monthDF <- as.data.frame(by_month)
plot(by_monthDF)
```

```{r by_origin}
by_origin <- h2o.group_by(flights.hex, by = "Origin", nrow("Origin"),
                          gb.control=list(na.methods="rm"))
by_originDF <- as.data.frame(by_origin)
plot(by_originDF)
```

Cancellations ratio

```{r cancelations}
cancellations_month <- h2o.group_by(data = flights.hex, by = "Month", 
                                    sum("Cancelled"), 
                                    gb.control= list(na.methods="rm"))
cancellations_month
cancellation_rate <- cancellations_month$sum_Cancelled/by_month$nrow
rates_table <- h2o.cbind(by_month$Month, cancellation_rate)
rates_tableDF = as.data.frame(rates_table)
plot(rates_tableDF, type = 'h')
```

Split the data in test and train sets

```{r split}
flights_split <- h2o.splitFrame(data = flights.hex, ratios = 0.85, seed = 511892)
flights.train <- flights_split[[1]]
flights.test <- flights_split[[2]]
```

Set predictor and response variables

```{r predictor}
Y = "DepDelay"
X = c("Origin", "Dest", "DayofMonth", "UniqueCarrier", "DayOfWeek", 
      "Month", "DepTime", "ArrTime", "Distance")
```

```{r model}
flights.glm <- h2o.glm(training_frame=flights.train, x=X, y=Y)
summary(flights.glm)
```

```{r predict}
pred <- h2o.predict(object = flights.glm, newdata = flights.test)
summary(pred$p1)
```